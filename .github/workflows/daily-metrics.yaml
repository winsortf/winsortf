name: daily-metrics

on:
  workflow_dispatch:
  push:
    branches: [main]
  schedule:
    - cron: "0 0 * * *"   # every day at 00:00 UTC

jobs:
  github-metrics:
    runs-on: ubuntu-latest

    # This controls what the built-in GITHUB_TOKEN is allowed to do.
    # We need to push the generated SVG to a branch, so give it write on contents.
    permissions:
      contents: write

    steps:
      - uses: lowlighter/metrics@latest
        with:
          # 1. Personal Access Token you created
          #    - store it in repo Settings → Secrets → Actions as METRICS_TOKEN
          #    - should at least have read:user (and read:org if you want org info,
          #      and repo if you want private repo stats)
          token: ${{ secrets.METRICS_TOKEN }}

          # 2. Commit settings
          # GITHUB_TOKEN is automatically provided by GitHub Actions.
          # We use it to commit the generated file back to the repo.
          output_action: commit
          committer_token: ${{ secrets.GITHUB_TOKEN }}
          committer_branch: github-metrics        # branch where the SVG will live
          committer_message: "build: update ${filename}"

          # 3. General config
          user: winsortf
          template: classic
          filename: github-metrics.svg
          base: header, activity, community
          config_timezone: Europe/London

          # 4. Languages plugin (RECENTLY USED VERSION)
          # This is the part that can currently crash upstream.
          # Keep it exactly like this if you specifically want recent activity.
          plugin_languages: yes
          plugin_languages_details: bytes-size, percentage
          plugin_languages_sections: recently-used
          plugin_languages_recent_load: 400        # how many events to inspect
          plugin_languages_recent_days: 14         # lookback window in days

          # 5. Achievements plugin
          plugin_achievements: yes
          plugin_achievements_threshold: B

          # 6. Notable contributions plugin
          plugin_notable: yes
          plugin_notable_filter: stars:>150
          plugin_notable_repositories: yes
